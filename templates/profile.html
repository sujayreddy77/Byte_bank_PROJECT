{% extends "layout.html" %}
{% block title %}Profile - ByteBank{% endblock %}

{% block content %}
<div class="profile-container">
  <h2 class="profile-title">My Profile</h2>

  {% if user %}
    <!-- Profile Header -->
    <div class="profile-card">
      <div class="profile-header">
        <div class="profile-avatar">{{ user.name[0]|upper }}</div>
        <div>
          <h3>{{ user.name }}</h3>
          <p class="profile-email">{{ user.email }}</p>
        </div>
      </div>

      <!-- Top Stats -->
      <div class="profile-stats">
        <div class="stat-box">
          <span class="stat-label">Daily Quota</span>
          <span class="stat-value">{{ user.daily_quota_mb }} MB</span>
        </div>
        <div class="stat-box">
          <span class="stat-label">Used Today</span>
          <span class="stat-value">{{ user.used_today_mb }} MB</span>
        </div>
        <div class="stat-box">
          <span class="stat-label">Wallet Balance</span>
          <span class="stat-value">{{ user.wallet.balance_mb }} MB</span>
        </div>
      </div>

      <!-- Grid Info Boxes -->
      <div class="profile-details-grid">
        <div class="detail-box">
          <div class="detail-icon">üíæ</div>
          <div>
            <p class="detail-label">Total Data Purchased</p>
            <p class="detail-value">{{ user.wallet.total_purchased_mb or 0 }} MB</p>
          </div>
        </div>

        <div class="detail-box">
          <div class="detail-icon">üìä</div>
          <div>
            <p class="detail-label">All-Time Usage</p>
            <p class="detail-value">{{ total_all_time }} MB</p>
          </div>
        </div>

        <div class="detail-box">
          <div class="detail-icon">‚è∞</div>
          <div>
            <p class="detail-label">Last Login</p>
            <p class="detail-value">{{ user.last_login.strftime('%Y-%m-%d %H:%M:%S') if user.last_login else 'Never' }}</p>
          </div>
        </div>

        <div class="detail-box">
          <div class="detail-icon">üóì</div>
          <div>
            <p class="detail-label">Account Created</p>
            <p class="detail-value">{{ user.created_at.strftime('%Y-%m-%d %H:%M:%S') if user.created_at else 'Unknown' }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Actions -->
    <div class="profile-actions">
      <a href="{{ url_for('update_profile') }}" class="btn btn-primary">Edit Profile</a>
      <a href="{{ url_for('change_password') }}" class="btn btn-secondary">Change Password</a>
      <a href="{{ url_for('transfer') }}" class="btn btn-outline">Transfer Data</a>
    </div>

    <!-- Transactions Section -->
    <div class="transactions-section">
      <h3>Recent Transactions</h3>
      {% if transactions %}
        <table class="transactions-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Type</th>
              <th>From</th>
              <th>To</th>
              <th>Amount (MB)</th>
              <th>Note</th>
            </tr>
          </thead>
          <tbody>
            {% for t in transactions %}
            <tr>
              <td>{{ t.timestamp.strftime('%Y-%m-%d %H:%M') if t.timestamp else 'N/A' }}</td>
              <td>
                {% if t.sender_id == user.id %}
                  Sent
                {% elif t.receiver_id == user.id %}
                  Received
                {% else %}
                  System
                {% endif %}
              </td>
              <td>{{ t.sender.email if t.sender else 'SYSTEM' }}</td>
              <td>{{ t.receiver.email if t.receiver else 'SYSTEM' }}</td>
              <td>{{ t.amount_mb }}</td>
              <td>{{ t.note or '' }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="no-data">No recent transactions found.</p>
      {% endif %}
    </div>
  {% else %}
    <p>Please <a href="{{ url_for('login_page') }}">login</a> to view your profile.</p>
  {% endif %}
</div>

<style>
.profile-container {
  max-width: 950px;
  margin: 40px auto;
  padding: 20px;
}

.profile-title {
  font-size: 2rem;
  color: #007bff;
  margin-bottom: 1.5rem;
  text-align: center;
}

/* Profile Card */
.profile-card {
  background: #fff;
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  margin-bottom: 30px;
}

/* Header with avatar */
.profile-header {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
}

.profile-avatar {
  width: 60px;
  height: 60px;
  background-color: #007bff;
  color: #fff;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 24px;
  margin-right: 16px;
  font-weight: bold;
}

.profile-email {
  color: #555;
  font-size: 0.95rem;
}

/* Top Stats Row */
.profile-stats {
  display: flex;
  justify-content: space-around;
  background-color: #f8f9fa;
  border-radius: 10px;
  padding: 12px 0;
  margin-bottom: 20px;
}

.stat-box {
  text-align: center;
}

.stat-label {
  display: block;
  color: #666;
  font-size: 0.9rem;
}

.stat-value {
  color: #007bff;
  font-weight: 600;
  font-size: 1.1rem;
}

/* Grid Info Section */
.profile-details-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 15px;
  margin-top: 15px;
}

.detail-box {
  display: flex;
  align-items: center;
  background: linear-gradient(to right, #f8faff, #eef5ff);
  border: 1px solid #e3ebf7;
  border-radius: 12px;
  padding: 12px 15px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.detail-box:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

.detail-icon {
  font-size: 1.6rem;
  margin-right: 10px;
  color: #007bff;
}

.detail-label {
  color: #666;
  font-size: 0.9rem;
}

.detail-value {
  color: #111;
  font-weight: 600;
  font-size: 1rem;
}

/* Buttons */
.profile-actions {
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
  margin-bottom: 30px;
}

.btn {
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: 500;
  text-decoration: none;
  text-align: center;
}

.btn-primary {
  background-color: #007bff;
  color: white;
}

.btn-primary:hover {
  background-color: #0056b3;
}

.btn-secondary {
  background-color: #6c757d;
  color: white;
}

.btn-secondary:hover {
  background-color: #5a6268;
}

.btn-outline {
  border: 1px solid #007bff;
  color: #007bff;
  background: transparent;
}

.btn-outline:hover {
  background-color: #007bff;
  color: white;
}

/* Transactions */
.transactions-section {
  background-color: #fff;
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

.transactions-section h3 {
  color: #007bff;
  margin-bottom: 15px;
}

.transactions-table {
  width: 100%;
  border-collapse: collapse;
}

.transactions-table th, .transactions-table td {
  padding: 12px 14px;
  border-bottom: 1px solid #e0e0e0;
  text-align: left;
}

.transactions-table th {
  background-color: #007bff;
  color: #fff;
  text-transform: uppercase;
  font-size: 0.9rem;
}

.transactions-table tr:hover {
  background-color: #f9f9f9;
}

.no-data {
  text-align: center;
  color: #666;
  font-style: italic;
  padding: 10px 0;
}
</style>
{% endblock %}