{% extends "layout.html" %}
{% block title %}Verify OTP - ByteBank{% endblock %}

{% block content %}
<h2 class="otp-title">Verify OTP</h2>

<div class="otp-card">

  <div class="form-group">
    <input type="text" id="identifier" placeholder="Email or Mobile" required>
  </div>

  <div class="form-group">
    <input type="text" id="otp" placeholder="Enter OTP" required>
  </div>

  <button id="verify-btn" class="btn">Verify OTP</button>

  <p class="msg" id="msg"></p>
</div>

<style>
.otp-title {
  font-size: 1.8rem;
  color: #007bff;
  margin-bottom: 1rem;
}

.otp-card {
  max-width: 420px;
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  margin: 0 auto;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

.form-group input {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #ccc;
  margin-bottom: 12px;
}

.btn {
  width: 100%;
  padding: 10px;
  background-color: #007bff;
  color: white;
  border-radius: 8px;
  cursor: pointer;
  border: none;
}

.btn:hover {
  background-color: #0056b3;
}

.msg {
  margin-top: 10px;
  text-align: center;
  color: #444;
  font-size: 0.95rem;
}
</style>
{% endblock %}

{% block js %}
<script>

document.getElementById('verify-btn').addEventListener('click', async () => {
    const identifier = document.getElementById('identifier').value.trim();
    const otp = document.getElementById('otp').value.trim();
    const msg = document.getElementById('msg');

    if (!identifier || !otp) {
        msg.textContent = "Enter both fields";
        return;
    }

    // Convert identifier to correct API fields
    const payload = {
        email: identifier.includes("@") ? identifier : null,
        mobile: !identifier.includes("@") ? identifier : null,
        otp: otp,
        purpose: "register"
    };

    const res = await fetch('/api/verify_otp', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
    });

    const data = await res.json();
    msg.textContent = data.message;

    if (data.success) {
        setTimeout(() => {
            window.location.href = '/register';
        }, 800);
    }
});
</script>
{% endblock %}